# Differences between Python and Stata implementation of ZZ1_beta's 
 - Rolling regressions: expanding vs strictly trailing
    - *Stata* asreg … , window(time 60) min(48) fitted uses a strict 60-period trailing window; results begin once ≥48 complete obs are available.
    - *Python* starts with an expanding window until 60, then switches to rolling. That’s not the same and will change early-sample residuals (eps_c_M, eps_r_M) and hence all betas. Fix by using a pure trailing window from the first index where ≥48 obs exist (i.e., use the last min(i+1,60) rows but never the full history before 60).
 - “60 months” window semantics (calendar vs row count) for asrol equivalents
    - *Stata* asrol … , window(time_avail_m 60) min(24) is calendar-based: it looks back 60 months by the time variable, not “last 60 rows”. This matters when a permno has missing months.
    - *Python* uses groupby(...).rolling(window=60) which is row-count based. If a stock skips months, your means/SDs/covariances come from fewer than 60 months. Fix by reindexing each permno to a complete monthly calendar (fill gaps with NaN) or use a time-offset window (e.g., 60 calendar months) and count non-missing values for min_periods=24.
 - Market regressions window inputs (templ variables) are correct but lagging must be calendar-accurate
    - Use `stata_multi_lag` from `pyCode/utils/stata_replication.py` to handle this
 - Variance in the beta denominator
    - *Stata* builds sd60_tempEpsDiff with asrol … stat(sd) and then uses variance in the denominator of all betas.
    - *Python* squares the rolling SD (**2) to form variance—good—but this must be computed on the same calendar window as the covariances (see #2). If you keep row-count windows you’ll get drift.